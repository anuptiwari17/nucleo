{
  "openapi": "3.0.0",
  "info": {
    "title": "Nucleo API",
    "version": "1.0.0",
    "description": "Lightweight OpenAPI spec generated from backend route files. Use /docs for interactive docs when server runs."
  },
  "servers": [
    { "url": "http://localhost:5000", "description": "Local dev" }
  ],
  "paths": {
    "/auth/login": {
      "post": {
        "summary": "Login",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Logged in user metadata",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/UserMinimal" }
              }
            }
          },
          "401": { "description": "Invalid credentials" }
        }
      }
    },
    "/auth/signup": {
      "post": {
        "summary": "Signup (create org + admin)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SignupRequest" }
            }
          }
        },
        "responses": {
          "201": { "description": "Organization and user created" }
        }
      }
    },
    "/users/create-manager": {
      "post": {
        "summary": "Create manager (admin)",
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateManager" } } }
        },
        "responses": { "201": { "description": "Manager created" } }
      }
    },
    "/users/create-employee": {
      "post": {
        "summary": "Create employee (manager/admin)",
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateEmployee" } } }
        },
        "responses": { "201": { "description": "Employee created" } }
      }
    },
    "/tasks/assign": {
      "post": {
        "summary": "Assign a task (manager)",
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AssignTask" } } }
        },
        "responses": { "201": { "description": "Task assigned" } }
      }
    },
    "/tasks/{taskId}/accept": {
      "put": {
        "summary": "Accept a task (employee)",
        "parameters": [{ "name": "taskId", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TaskAction" } } } },
        "responses": { "200": { "description": "Task accepted" } }
      }
    },
    "/tasks/{taskId}/complete": {
      "put": {
        "summary": "Complete a task (employee)",
        "parameters": [{ "name": "taskId", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TaskActionWithNote" } } } },
        "responses": { "200": { "description": "Task completed" } }
      }
    },
    "/tasks/{taskId}/fail": {
      "put": {
        "summary": "Fail a task (employee)",
        "parameters": [{ "name": "taskId", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TaskFail" } } } },
        "responses": { "200": { "description": "Task marked failed" } }
      }
    },
    "/tasks/stats/organization/{organizationId}": {
      "get": {
        "summary": "Get organization task stats",
        "parameters": [{ "name": "organizationId", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "Stats" } }
      }
    },
    "/tasks/organization/{organizationId}": {
      "get": {
        "summary": "List tasks for an organization",
        "parameters": [{ "name": "organizationId", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "Tasks list" } }
      }
    }
  },
  "components": {
    "schemas": {
      "LoginRequest": {
        "type": "object",
        "properties": { "email": { "type": "string" }, "password": { "type": "string" } },
        "required": ["email", "password"]
      },
      "SignupRequest": {
        "type": "object",
        "properties": {
          "firstName": { "type": "string" },
          "lastName": { "type": "string" },
          "email": { "type": "string" },
          "password": { "type": "string" },
          "organizationName": { "type": "string" },
          "role": { "type": "string" }
        },
        "required": ["firstName", "lastName", "email", "password", "organizationName"]
      },
      "UserMinimal": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "full_name": { "type": "string" },
          "role": { "type": "string" },
          "organization_id": { "type": "integer" }
        }
      },
      "CreateManager": {
        "type": "object",
        "properties": { "full_name": { "type": "string" }, "email": { "type": "string" }, "department": { "type": "string" }, "password": { "type": "string" }, "organization_id": { "type": "integer" } },
        "required": ["full_name", "email", "department", "organization_id"]
      },
      "CreateEmployee": {
        "type": "object",
        "properties": { "full_name": { "type": "string" }, "email": { "type": "string" }, "position": { "type": "string" }, "password": { "type": "string" }, "manager_id": { "type": "integer" }, "organization_id": { "type": "integer" } },
        "required": ["full_name", "email", "position", "manager_id", "organization_id"]
      },
      "AssignTask": {
        "type": "object",
        "properties": {
          "title": { "type": "string" },
          "description": { "type": "string" },
          "priority": { "type": "string", "enum": ["low","medium","high"] },
          "due_date": { "type": "string", "format": "date-time" },
          "assigned_by": { "type": "integer" },
          "assigned_to": { "type": "integer" },
          "organization_id": { "type": "integer" }
        },
        "required": ["title","due_date","assigned_by","assigned_to","organization_id"]
      },
      "TaskAction": { "type": "object", "properties": { "user_id": { "type": "integer" } }, "required": ["user_id"] },
      "TaskActionWithNote": { "type": "object", "properties": { "user_id": { "type": "integer" }, "note": { "type": "string" } }, "required": ["user_id"] },
      "TaskFail": { "type": "object", "properties": { "user_id": { "type": "integer" }, "reason": { "type": "string" } }, "required": ["user_id","reason"] }
    }
  }
}
